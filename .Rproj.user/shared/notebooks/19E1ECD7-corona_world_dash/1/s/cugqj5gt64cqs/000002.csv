"0","countries <- c(""Italy"", ""Spain"", ""Brazil"")"
"0",""
"0","ects <- 10**(cts) - 1"
"0","d0ts <- ects * apply(ects, 2, function(x) x >= 100)"
"0","ld0ts <- lapply(countries, function(n) as.vector(coredata(d0ts[,n])))"
"0","ld0ts <- lapply(ld0ts, function(x) x[x!=0])"
"0","names(ld0ts) <- countries"
"0",""
"0","N = max(vapply(ld0ts, length, numeric(1)))"
"0",""
"0","d0f <- rbind(as.data.frame(lapply(ld0ts, '[', 1)), as.data.frame(lapply(ld0ts, '[', 2)))"
"0","for (i in 3:N) {"
"0","   d0f <- rbind(d0f, as.data.frame(lapply(ld0ts, '[', i)))"
"0","}"
"0",""
"0","daysToDouble <- c(2,4,7)"
"0","exdf <- NULL"
"0","for (i in daysToDouble) {"
"0","     exdf <- cbind(exdf, vapply(seq(ceiling(i*log(100, 2)), length.out = N), function(d) 2**(d/i), numeric(1)))"
"0","}"
"0",""
"0","d0f <- cbind(d0f, exdf)"
"0","d0f <- log(d0f, 2)"
"0","d0f <- cbind(1:N, d0f)"
"0","DD  <- paste0(""D"", daysToDouble, ""D"")"
"0","colnames(d0f) <- c('Days', countries, DD)"
"0",""
"0","p <- plot_ly(d0f, x = ~Days)"
"0","for (country in countries) {"
"0","    p <- p %>% add_trace(data = d0f, y = as.formula(paste0(""~"", country)), name = country, type = 'scatter', mode = 'lines+markers')"
"0","}"
"0",""
"0","for (days in DD) {"
"0","  p <- p %>% add_lines(data = d0f, y = as.formula(paste0('~', days)), name = days, "
"0","                       line = list(color = 'rgb(205, 12, 24)', dash = 'dot', width = 1),"
"0","                       showlegend = FALSE)"
"0","}"
"0",""
"0","xax <- list("
"0","  title = 'Days from D0',"
"0","  titlefont = f1,"
"0","  showticklabels = TRUE,"
"0","  range = c(0.5, 45),"
"0","  size = 13"
"0",")"
"0",""
"0","yax <- list("
"0","  title = 'Confirmed cases',"
"0","  titlefont = f1,"
"0","  showticklabels = TRUE,"
"0","#  type = ""log"","
"0","  size = 50"
"0",")"
"0",""
"0","leg <- list("
"0","  orientation = 'h',"
"0","  y = -0.15,"
"0","  x = 0.42"
"0","  )"
"0",""
"0","D1DA <- list("
"0","  xref = 'paper',"
"0","  yref = 'y',"
"0","  x = 0.915,"
"0","#  y = tail(d0f,1)[,'D1D'],"
"0","  xanchor = 'left',"
"0","  yanchor = 'middle',"
"0","  text = ~""Doubles every day"","
"0","  font = list(family = 'Arial',"
"0","              size = 9.9,"
"0","              color = 'rgba(205,12,24,1)'),"
"0","  showarrow = FALSE)"
"0",""
"0","D2DA <- list("
"0","  xref = 'paper',"
"0","  yref = 'y',"
"0","  x = 0.915,"
"0","  y = tail(d0f,1)[,'D2D'],"
"0","  xanchor = 'left',"
"0","  yanchor = 'middle',"
"0","  text = ~""Doubles every 2 days"","
"0","  font = list(family = 'Arial',"
"0","              size = 9.9,"
"0","              color = 'rgba(205,12,24,1)'),"
"0","  showarrow = FALSE)"
"0",""
"0","D4DA <- list("
"0","  xref = 'paper',"
"0","  yref = 'y',"
"0","  x = 0.915,"
"0","  y = tail(d0f,1)[,'D4D'],"
"0","  xanchor = 'left',"
"0","  yanchor = 'middle',"
"0","  text = ~""Doubles every 4 days"","
"0","  font = list(family = 'Arial',"
"0","              size = 9.9,"
"0","              color = 'rgba(205,12,24,1)'),"
"0","  showarrow = FALSE)"
"0",""
"0","D7DA <- list("
"0","  xref = 'paper',"
"0","  yref = 'y',"
"0","  x = 0.915,"
"0","  y = tail(d0f,1)[,'D7D'],"
"0","  xanchor = 'left',"
"0","  yanchor = 'middle',"
"0","  text = ~""Doubles every 7 days"","
"0","  font = list(family = 'Arial',"
"0","              size = 9.9,"
"0","              color = 'rgba(205,12,24,1)'),"
"0","  showarrow = FALSE)"
"0",""
"0","p <- p %>% layout(xaxis = xax, yaxis = yax, legend = leg)"
"0","#p <- p %>% layout(annotations = D1DA)"
"0","p <- p %>% layout(annotations = D2DA)"
"0","p <- p %>% layout(annotations = D4DA)"
"0","p <- p %>% layout(annotations = D7DA)"
"0",""
"0","p"
